{"version":3,"mappings":"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","names":["stream","p2pcf"],"sources":["../../../../../../../src/lib/App.svelte"],"sourcesContent":["<script>\r\n\t// @ts-nocheck\r\n\r\n\timport { onMount } from 'svelte';\r\n\r\n\timport Button from './atomic/Button.svelte';\r\n\r\n\tconst myWorker = {}; // { workerUrl: 'https://p2pcf.douganderson444.workers.dev/' };\r\n\r\n\tlet P2PCF;\r\n\tlet stream;\r\n\tlet username, publicKey, room;\r\n\r\n\tlet sessionId;\r\n\r\n\tconst removePeerUi = (clientId) => {\r\n\t\tdocument.getElementById(clientId)?.remove();\r\n\t\tdocument.getElementById(`${clientId}-video`)?.remove();\r\n\t};\r\n\r\n\tconst addPeerUi = (sessionId) => {\r\n\t\tif (document.getElementById(sessionId)) return;\r\n\r\n\t\tconst peerEl = document.createElement('div');\r\n\t\tpeerEl.style = 'display: flex;';\r\n\r\n\t\tconst name = document.createElement('div');\r\n\t\tname.innerText = sessionId.substring(0, 5);\r\n\r\n\t\tpeerEl.id = sessionId;\r\n\t\tpeerEl.appendChild(name);\r\n\r\n\t\tdocument.getElementById('peers').appendChild(peerEl);\r\n\t};\r\n\r\n\tonMount(async () => {\r\n\t\tif (!document.location.hash) {\r\n\t\t\tdocument.location =\r\n\t\t\t\tdocument.location.toString() + `#room-example-${Math.floor(Math.random() * 100000)}`;\r\n\t\t}\r\n\t\tP2PCF = (await import('p2pcf')).default;\r\n\t\tconnect();\r\n\r\n\t\tdocument.getElementById('session-id').innerText =\r\n\t\t\tp2pcf.sessionId.substring(0, 5) + '@' + p2pcf.roomId + ':';\r\n\r\n\t\tdocument.getElementById('send-button').addEventListener('click', () => {\r\n\t\t\tconst box = document.getElementById('send-box');\r\n\t\t\taddMessage(p2pcf.sessionId.substring(0, 5) + ': ' + box.value);\r\n\t\t\tp2pcf.broadcast(new TextEncoder().encode(box.value));\r\n\t\t\tbox.value = '';\r\n\t\t});\r\n\r\n\t\tdocument.getElementById('video-button').addEventListener('click', async () => {\r\n\t\t\tstream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n\r\n\t\t\tfor (const peer of p2pcf.peers.values()) {\r\n\t\t\t\tpeer.addStream(stream);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tp2pcf.start();\r\n\t});\r\n\r\n\tfunction handleConnect(peer) {\r\n\t\tconsole.log('Peer connect', peer.id, peer);\r\n\t\tif (stream) {\r\n\t\t\tpeer.addStream(stream);\r\n\t\t}\r\n\r\n\t\tpeer.on('track', (track, stream) => {\r\n\t\t\tconsole.log('got track', track);\r\n\t\t\tconst video = document.createElement('video');\r\n\t\t\tvideo.id = `${peer.id}-video`;\r\n\t\t\tvideo.srcObject = stream;\r\n\t\t\tvideo.setAttribute('playsinline', true);\r\n\t\t\tdocument.getElementById('videos').appendChild(video);\r\n\t\t\tvideo.play();\r\n\t\t});\r\n\r\n\t\taddPeerUi(peer.id);\r\n\t}\r\n\tfunction handleClose(peer) {\r\n\t\tconsole.log('Peer close', peer.id, peer);\r\n\t\tremovePeerUi(peer.id);\r\n\t}\r\n\r\n\tfunction handleMsg(peer, msg) {\r\n\t\tconsole.log('Peer msg', peer.id, peer, msg);\r\n\t\taddMessage(peer.id.substring(0, 5) + ': ' + new TextDecoder('utf-8').decode(data));\r\n\t}\r\n\r\n\tfunction addMessage(message) {\r\n\t\tconst messageEl = document.createElement('div');\r\n\t\tmessageEl.innerText = message;\r\n\r\n\t\tdocument.getElementById('messages').appendChild(messageEl);\r\n\t}\r\n\r\n\tfunction connect() {\r\n\t\tconst myUsername = 'user-' + Math.floor(Math.random() * 100000);\r\n\t\tconst myRoom = document.location.hash.substring(1);\r\n\t\tconst p2pcf = new P2PCF(myUsername, myRoom, myWorker);\r\n\t\twindow.p2pcf = p2pcf;\r\n\r\n\t\tp2pcf.on('peerconnect', handleConnect);\r\n\t\tp2pcf.on('peerclose', handleClose);\r\n\t\tp2pcf.on('msg', handleMsg);\r\n\t}\r\n</script>\r\n\r\n<main class=\"p-4\">\r\n\t<h3 class=\"pt-2 m-0\" style=\"padding-top: 8px; margin: 0;\">P2PCF example</h3>\r\n\t<h6 style=\"padding-top: 8px; padding-bottom: 24px; margin: 0;\">\r\n\t\tShare this URL to connect via P2PCF + WebRTC\r\n\t</h6>\r\n\r\n\t<div style=\"display: flex; flex-direction: row;\">\r\n\t\t<div style=\"display: flex; flex-direction: column; min-width: 200px;\">\r\n\t\t\tPeers:\r\n\t\t\t<div id=\"peers\" style=\"display: flex; flex-direction: column;\" />\r\n\t\t</div>\r\n\t\t<div style=\"display: flex; flex-direction: column;\">\r\n\t\t\tMessages:\r\n\t\t\t<div id=\"messages\" style=\"display: flex; flex-direction: column;\" />\r\n\t\t</div>\r\n\t</div>\r\n\t<div id=\"videos\" style=\"display: flex; flex-direction: row;\" />\r\n\t<div style=\"padding-top: 24px; display: flex; flex-direction: row;\">\r\n\t\t<div style=\"padding-right: 4px; \" id=\"session-id\" />\r\n\t\t<form onsubmit=\"return false;\">\r\n\t\t\t<input class=\"border\" id=\"send-box\" type=\"text\" />\r\n\t\t\t<button class=\"border p-2 rounded bg-neutral-200\" type=\"submit\" id=\"send-button\">Send</button>\r\n\t\t</form>\r\n\t</div>\r\n\t<button\r\n\t\tclass=\"border w-24 bg-neutral-200 p-2 rounded\"\r\n\t\tstyle=\"width: 100px;\"\r\n\t\ttype=\"submit\"\r\n\t\tid=\"video-button\">Enable Video</button\r\n\t>\r\n</main>\r\n\r\n<!--\r\nA tiny WebRTC App\r\n<input\r\n\tclass=\"bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\r\n\ttype=\"text\"\r\n\tplaceholder=\"Username\"\r\n\ton:input={(e) => {\r\n\t\tsetUsername(e.target.value);\r\n\t}}\r\n/>\r\n<input\r\n\tclass=\"bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\r\n\ttype=\"text\"\r\n\tplaceholder=\"Public Key\"\r\n\ton:input={(e) => {\r\n\t\tsetPublicKey(e.target.value);\r\n\t}}\r\n/>\r\n\r\n<input\r\n\tclass=\"bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\r\n\ttype=\"text\"\r\n\tplaceholder=\"Room\"\r\n\ton:input={(e) => {\r\n\t\tsetRoom(e.target.value);\r\n\t}}\r\n/>\r\n\r\n<Button type=\"green\" disabled={!username || !publicKey || !room} on:click={connect}>Connect</Button>\r\n\r\n<Spinner />\r\n\r\n<div class=\"text-red-500 text-center\">\r\n\t{error}\r\n</div>\r\n\r\n<div class=\"text-green-500 text-center\">\r\n\t{success}\r\n</div>\r\n\r\n<Button\r\n\ttype=\"red\"\r\n\tdisabled={!p2pcf}\r\n\ton:click={() => {\r\n\t\tp2pcf.disconnect();\r\n\t}}\r\n>\r\n\tDisconnect\r\n</Button>\r\n\r\n<Button\r\n\ttype=\"green\"\r\n\tdisabled={!p2pcf}\r\n\ton:click={() => {\r\n\t\tp2pcf.send('Hello World');\r\n\t}}\r\n>\r\n\tSend\r\n</Button>\r\n\r\n<Button clickHandler={connect}>Connect</Button> -->\r\n<style>\r\n\t#peers div {\r\n\t\tpadding: 8px;\r\n\t\tfont-size: 18px;\r\n\t}\r\n\t#messages div {\r\n\t\tpadding: 8px;\r\n\t\tfont-size: 18px;\r\n\t}\r\n</style>\r\n"],"file":"_app/immutable/components/pages/_page.svelte-24b6c850.js"}